<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="pragma" content="no-cache" /> 
    <meta http-equiv="Cache-Control" content="no-cache,must-revalidate" /> 
    <meta http-equiv="expires" content="Wed,26 Feb 1997 08:21:57 GMT" /> 
    <title>延时可视化</title>
    <script src="/static/pingMap/esl.js"></script>
	<script src="/static/pingMap/optionOperate.js"></script>
	<script src="/static/pingMap/dataTemplate.js"></script>
	<script src="/static/pingMap/showLossPacket.js"></script>
	<link rel="stylesheet" type="text/css" href="/static/pingMap/css/pingMap.css">
    <script type="text/javascript" src="/static/public/js/jquery.js"></script>
    <script type="text/javascript" src="/static/public/js/getJsonFileContent.js"></script>

</head>
<body>
<div id="text_area"></div>
    <div id="main"></div>
    <script type="text/javascript">
	function getMarkLine(){
		host_city=nagiosData.host_city
	        network_data=nagiosData.data
	        line_type=nagiosData.line_type
		//nagiosServerIp:{nagiosServerIp:{"rta": "", "lost": ""},... ...}
		markLine_data=[]
		for (var nagiosServerIp in network_data){
			for (var nagiosClientIp in network_data[nagiosServerIp]){
				if ( network_data[nagiosServerIp][nagiosClientIp]==null  )
					continue
				lostValue=parseInt(network_data[nagiosServerIp][nagiosClientIp]["lost"])
				if(lostValue<=5){
					lostValue=0 //green
				}else if(lostValue<=10){
					lostValue=50 //yellow
				}else{
					lostValue=100 //red
				}
				markLine_data.push([{"name": host_city[nagiosServerIp]},{"name": host_city[nagiosClientIp], "value":lostValue}])
			}
		}
		return markLine_data
	}

	function paddData(blankOption,markLine_data){
		array=[]
		array.push(markLine_data)
		//console.log(JSON.stringify(template))
		dataTemplate
		dataTemplate["markLine"]["data"]=markLine_data
		blankOption["series"].push(dataTemplate);
		//blankOption.legend.data = legend_data;
		return blankOption
	}


	function getLegend_data(host_city){
		legend_data=[]
		for (var nagiosServerIp in host_city){
			legend_data.push(host_city[nagiosServerIp])
		}
		return legend_data
	}

	function main(){
		showLossPacket()
		blankOption=getOption()
		nagiosData=getJsonFileContent("/static/pingMap/data/nagiosData.txt")
		markLine_data=getMarkLine(nagiosData)
		//legend_data=getLegend_data(nagiosData.host_city)
		fullOption=paddData(blankOption,markLine_data)
		setOption(fullOption)
	}
	main()
	var int=self.setInterval("main()",60000)
</script>
</body>
</html>
